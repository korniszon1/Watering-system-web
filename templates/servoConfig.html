<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konfiguracja</title>
</head>
<body>
    <a href="/">Strona główna</a>
    <h1>Ustawienia konfiguracji obrotu</h1>
    <!--    0    "auto",        # water_mode
            1     30.0,          # moisture_pct(%)
            2     5,             # water_time
            3     10,          # water_mililiters
            4     "auto",       # servo_mode
            5     100,            # auto_threshold
            6     4,            # servo_time
            7     45,           # servo_angle
            8     30             # log_timer 
            -->
    <form action="/update-servo-conf" method="post" id="form">
        <label for="mode">Wybierz tryb obrotu</label>
        <select name="mode" id="tryb">
            <option value="auto" {% if config[4] == 'auto' %} selected{% endif %}>Automatyczny</option>
            <option value="manual" {% if config[4] == 'manual' %} selected{% endif %}>Okresowy</option>
            <option value="set" {% if config[4] == 'set' %} selected{% endif %}>Statyczny</option>
        </select>
        <div id="auto" {% if config[4] != 'auto' %} hidden{% endif %}>
            <label for="auto-threshold">Wybierz wartość minimalnego naświetlenia</label>
            <input type="range" min="50" max="1000" step="50" id="auto-threshold" value="{{config[5]}}" name="auto-threshold">
            <p id="threshold-value">{{config[5]}}</p>
        </div>
        <div id="manual" {% if config[4] != 'manual' %} hidden{% endif %}>
            <label for="servo-timer">Co ile minut obracać doniczkę o 180°</label>
            <input type="range" min="1" max="180" step="3" id="servo-timer" value="{{config[6]}}" name="servo-timer">
            <p id="timer-value">{{config[6]}}min</p>
        </div>
        <div id="set" {% if config[4] != 'set' %} hidden{% endif %}>
            <label for="servo-angle">Jak ustawić doniczkę</label>
            <input type="range" min="0" max="180" id="servo-angle" value="{{config[7]}}" name="servo-angle">
            <p id="angle-value">{{config[7]}}°</p>
        </div>
        </br>
        </br>
        <input type="submit" value="Zaktualizuj konfiguracje wody">
        <input type="reset" value="Przywróć ustawienia" id="reset">
    </form>
    
    <script>
        var tryb = document.getElementById("tryb");
        var auto = document.getElementById("auto");
        var manual = document.getElementById("manual");
        var set = document.getElementById("set");

        var thresholdRange = document.getElementById("auto-threshold");
        var thresholdValue = document.getElementById("threshold-value");

        var manual = document.getElementById("manual");
        var servoTime = document.getElementById("servo-timer");
        var timerValue = document.getElementById("timer-value");

        var servoAngle = document.getElementById("servo-angle")
        var angleValue = document.getElementById("angle-value");

        var resetButton = document.getElementById("reset");

        thresholdRange.addEventListener('input', () =>{
            thresholdValue.innerHTML = thresholdRange.value
        })

        servoTime.addEventListener('input', () =>{
            timerValue.innerHTML = servoTime.value +"min"
        })

        servoAngle.addEventListener('input', () =>{
            angleValue.innerHTML = servoAngle.value +"°"
        })
        function update_form() {
            switch (tryb.value) {
                case "auto":
                    auto.hidden = false;
                    set.hidden = true;
                    manual.hidden = true;
                    break;
                case "set":
                    auto.hidden = true;
                    set.hidden = false;
                    manual.hidden = true;
                    
                    break;
                case "manual":
                    auto.hidden = true;
                    set.hidden = true;
                    manual.hidden = false;
                    
                    break;
                default:
                    break;
            }
        }
        tryb.addEventListener('change',update_form)

        window.addEventListener("load", () => {
            update_form()
        });

        document.getElementById("form").addEventListener('reset', () => {
            setTimeout(() => {
                console.log("po resecie");
                update_form();
                servoAngle.dispatchEvent(new Event('input'));
                thresholdRange.dispatchEvent(new Event('input'));
                servoTime.dispatchEvent(new Event('input'));
            }, 0);
        })
    </script>
</body>
</html>